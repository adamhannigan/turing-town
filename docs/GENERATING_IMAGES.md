# Generating AI Images for Turing Town

This document explains how to generate AI images for buildings and UI elements using the Scenario API.

## Overview

Turing Town uses AI-generated images for building sprites, icons, and other game assets. These are generated using the [Scenario API](https://www.scenario.com/), which creates pixel art and isometric game assets.

## Prerequisites

To generate images, you need:

1. A Scenario API account ([sign up](https://www.scenario.com/))
2. API credentials (API Key and API Secret)

## Setting Up Credentials

### For GitHub Actions (Recommended)

Configure credentials in your repository's GitHub environment:

1. Go to **Settings → Environments**
2. Create or select the **copilot** environment
3. Add these environment secrets:
   - `SCENARIO_API_KEY` - Your Scenario API key
   - `SCENARIO_API_SECRET` - Your Scenario API secret

Once configured, you can use the automated workflow to generate images (see "Using GitHub Actions" below).

> **Note about GitHub Copilot agent:** The Copilot agent's sandboxed environment blocks external API access for security. While it can see the credentials, it cannot directly call the Scenario API. Use the GitHub Actions workflow or local generation instead.

### For Local Development

Create a `.env` file in the project root (this file is gitignored):

```bash
SCENARIO_API_KEY=your_api_key_here
SCENARIO_API_SECRET=your_api_secret_here
```

Or export as environment variables:

```bash
export SCENARIO_API_KEY="your_api_key_here"
export SCENARIO_API_SECRET="your_api_secret_here"
```

## Generating Building Images

### Using GitHub Actions (Easiest)

The repository includes a GitHub Actions workflow that can generate images with proper network access:

1. Go to **Actions** tab in GitHub
2. Select **Generate AI Images** workflow
3. Click **Run workflow**
4. Optionally specify building IDs (e.g., `house shop`) or leave empty for all buildings
5. The workflow will generate images and commit them automatically

This is the recommended method as it has proper network access to the Scenario API.

### Using Local Command Line

To generate images for all buildings in the game catalog:

```bash
npm run generate-images
```

This will:
1. Read the building definitions from `src/game/state.ts` (BUILDING_CATALOG)
2. Generate an AI image for each building using the Scenario API
3. Save the images to `public/assets/<building-id>.png`
4. Each image is 56×56 pixels, matching the game's tile size

To generate images for specific buildings only:

```bash
npm run generate-images house shop
```

## Image Models

The generation script uses different Scenario models for different asset types:

- **Building sprites**: `SCENARIO_MODEL_GAME_ASSETS` - Isometric pixel art style
- **UI elements**: `SCENARIO_MODEL_UI` - Flat icon style
- **Game tiles**: `SCENARIO_MODEL_GAME_ASSETS` - Isometric style

These model IDs are defined in `agents/skills/images.ts`.

## Current Image Status

The repository currently contains placeholder images generated by `npm run generate-placeholders`. These are simple colored rectangles created programmatically using the `pureimage` library.

To replace these with AI-generated images:
1. Ensure Scenario API credentials are configured (see above)
2. Run `npm run generate-images`
3. The placeholder images will be overwritten with AI-generated assets

## Troubleshooting

### "Scenario API credentials missing" error

This means the environment variables are not set. Follow the steps in "Setting Up Credentials" above.

### "ENOTFOUND api.cloud.scenario.com" or network errors

This error occurs when the environment doesn't have network access to external APIs. This is common in:
- GitHub Copilot agent sandboxed environments (security restriction)
- CI environments with restricted network access
- Firewalled development environments

**Solutions:**
1. Use the GitHub Actions workflow (see "Using GitHub Actions" above) - it runs with full network access
2. Generate images on your local machine where network access is available
3. See [COPILOT_IMAGE_GENERATION.md](./COPILOT_IMAGE_GENERATION.md) for detailed information about limitations

### Images look wrong or don't match the game style

The image generation uses prompts defined in `scripts/generate-images.ts`. You can modify the prompts to better match your desired style:

```typescript
const result = await requestImage({
  prompt: `isometric pixel art ${name.toLowerCase()} building, ${size}x${size}, game asset, clear silhouette`,
  // Adjust this prompt as needed
  modelId: SCENARIO_MODEL_GAME_ASSETS,
  width: size,
  height: size,
  aspectRatio: "1:1",
});
```

## Adding New Buildings

When adding a new building type to the game:

1. Add the building definition to `BUILDING_CATALOG` in `src/game/state.ts`
2. Run `npm run generate-images <building-id>` to generate its image
3. Add the image to the Phaser preload in `src/game/scene.ts`:
   ```typescript
   this.load.image('building-id', baseUrl + 'assets/building-id.png')
   ```

## Cost Considerations

Generating images via the Scenario API incurs API usage costs. Each building generation creates one image. Check your Scenario account for current pricing and usage limits.

For development, you can use the placeholder images by running:

```bash
npm run generate-placeholders
```

This creates simple colored rectangles that don't require API credentials.
