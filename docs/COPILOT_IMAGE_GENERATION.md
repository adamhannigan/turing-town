# Copilot Image Generation - Status and Instructions

## Current Status

✅ **Scenario API credentials are properly configured** in the GitHub Copilot environment:
- `SCENARIO_API_KEY` is set (28 characters)
- `SCENARIO_API_SECRET` is set (24 characters)

❌ **Network limitation**: The Copilot agent's sandboxed environment blocks access to external APIs including `api.cloud.scenario.com`. This is a security feature to prevent unauthorized external access.

## What This Means

The Copilot agent **cannot** directly generate images using the Scenario API due to network restrictions, even though the credentials are correctly configured. This is expected behavior in sandboxed environments.

## Workarounds

### Option 1: Generate Images Locally (Recommended)

Developers with the credentials can generate images on their local machine:

```bash
# Set credentials locally
export SCENARIO_API_KEY="your_key_here"
export SCENARIO_API_SECRET="your_secret_here"

# Generate all building images
npm run generate-images

# Or generate specific buildings
npm run generate-images house shop factory
```

The generated images will be saved to `public/assets/` and can be committed to the repository.

### Option 2: Use GitHub Actions Workflow

Create a GitHub Actions workflow that runs in an environment with external API access:

```yaml
name: Generate AI Images
on:
  workflow_dispatch:
    inputs:
      buildings:
        description: 'Building IDs to generate (space-separated, or "all")'
        required: false
        default: 'all'

jobs:
  generate:
    runs-on: ubuntu-latest
    environment: copilot  # Uses the copilot environment secrets
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - run: npm ci
      
      - name: Generate Images
        env:
          SCENARIO_API_KEY: ${{ secrets.SCENARIO_API_KEY }}
          SCENARIO_API_SECRET: ${{ secrets.SCENARIO_API_SECRET }}
        run: |
          if [ "${{ github.event.inputs.buildings }}" = "all" ]; then
            npm run generate-images
          else
            npm run generate-images ${{ github.event.inputs.buildings }}
          fi
      
      - name: Commit Generated Images
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add public/assets/*.png
          git diff --staged --quiet || git commit -m "Generate AI images for buildings"
          git push
```

### Option 3: Request Network Access

If the Copilot agent frequently needs to generate images, you can request that `api.cloud.scenario.com` be added to the allowlist for the sandboxed environment. However, this is typically not done for external APIs.

## Current Placeholder Images

The repository currently contains placeholder images in `public/assets/`:
- `house.png` (260 bytes) - Simple colored placeholder
- `shop.png` (1.2 KB) - Simple colored placeholder  
- `factory.png` (260 bytes) - Simple colored placeholder
- Various icons (342 bytes - 1.3 KB)

These were generated using `npm run generate-placeholders` and serve as functional placeholders until AI-generated images are created.

## Verification

To verify that credentials are properly set and test the generation script:

```bash
# Check if credentials are set
echo "API Key: ${SCENARIO_API_KEY:+SET (${#SCENARIO_API_KEY} chars)}"
echo "API Secret: ${SCENARIO_API_SECRET:+SET (${#SCENARIO_API_SECRET} chars)}"

# Test the generation script (will fail with network error in sandboxed environment)
npm run generate-images
```

Expected output in sandboxed environment:
```
TypeError: fetch failed
  [cause]: Error: getaddrinfo ENOTFOUND api.cloud.scenario.com
```

This confirms credentials are loaded but external network access is blocked.

## Next Steps

1. **For local development**: Follow Option 1 above to generate images locally
2. **For automated generation**: Implement Option 2 (GitHub Actions workflow)
3. **For Copilot agents**: Use the existing placeholder images or request that assets be generated by other means

## Related Documentation

- [GENERATING_IMAGES.md](./GENERATING_IMAGES.md) - Complete guide to image generation
- [agents/skills/images.ts](/agents/skills/images.ts) - Scenario API integration code
- [agents/context/game-rules.md](/agents/context/game-rules.md) - Guidelines for adding new images
